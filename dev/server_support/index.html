<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Server support · LibSSH</title><meta name="title" content="Server support · LibSSH"/><meta property="og:title" content="Server support · LibSSH"/><meta property="twitter:title" content="Server support · LibSSH"/><meta name="description" content="Documentation for LibSSH."/><meta property="og:description" content="Documentation for LibSSH."/><meta property="twitter:description" content="Documentation for LibSSH."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LibSSH</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">LibSSH.jl</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../sessions_and_channels/">Sessions and Channels</a></li><li class="is-active"><a class="tocitem" href>Server support</a><ul class="internal"><li><a class="tocitem" href="#SSH-Binds"><span>SSH Binds</span></a></li><li><a class="tocitem" href="#Demo-server"><span>Demo server</span></a></li></ul></li><li><a class="tocitem" href="../utilities/">Utilities</a></li><li><a class="tocitem" href="../bindings/">Low-level bindings</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Server support</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Server support</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JamesWrigley/LibSSH.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JamesWrigley/LibSSH.jl/blob/master/docs/src/server_support.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Server-support"><a class="docs-heading-anchor" href="#Server-support">Server support</a><a id="Server-support-1"></a><a class="docs-heading-anchor-permalink" href="#Server-support" title="Permalink"></a></h1><p><em>The symbols documented on this page are intended to be safe. They may throw exceptions but they should never cause memory corruptions or segfaults if used correctly.</em></p><ul><li><a href="#Server-support">Server support</a></li><li class="no-marker"><ul><li><a href="#SSH-Binds">SSH Binds</a></li><li><a href="#Demo-server">Demo server</a></li></ul></li></ul><hr/><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.RequestType" href="#LibSSH.RequestType"><code>LibSSH.RequestType</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">primitive type RequestType &lt;: Enum{Int32} 32</code></pre><p>Enum for the types of SSH requests a client can send to a server:</p><ul><li><code>RequestType_Auth</code></li><li><code>RequestType_ChannelOpen</code></li><li><code>RequestType_Channel</code></li><li><code>RequestType_Service</code></li><li><code>RequestType_Global</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/LibSSH.jl#L79">source</a></section></article><h2 id="SSH-Binds"><a class="docs-heading-anchor" href="#SSH-Binds">SSH Binds</a><a id="SSH-Binds-1"></a><a class="docs-heading-anchor-permalink" href="#SSH-Binds" title="Permalink"></a></h2><p>The main type you care about for writing a server is the <a href="#LibSSH.Bind"><code>Bind</code></a>, which is somewhat analogous to a listening socket. It can be bound to a port and when a connection is attempted by a client it can be accepted with <a href="../bindings/#LibSSH.lib.ssh_bind_accept-Tuple{Any, Any}"><code>lib.ssh_bind_accept()</code></a>. Implementing everything else (including authentication) must be done yourself.</p><p>If you&#39;re writing a server and want to implement keyboard-interactive authentication, also see <a href="../utilities/#LibSSH.message_auth_interactive_request"><code>message_auth_interactive_request</code></a>.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>There are some examples of using libssh&#39;s C API to write a server <a href="https://gitlab.com/libssh/libssh-mirror/-/blob/master/examples/samplesshd-cb.c">here</a> (using callbacks), and another one demonstrating keyboard-interactive authentication <a href="https://gitlab.com/libssh/libssh-mirror/-/blob/master/examples/samplesshd-kbdint.c">here</a> (not using callbacks). You can also check the source for the <a href="#Demo-server">Demo server</a>.</p></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Bind" href="#LibSSH.Bind"><code>LibSSH.Bind</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct Bind</code></pre><ul><li><p><code>ptr::Union{Nothing, Ptr{LibSSH.lib.ssh_bind_struct}}</code></p></li><li><p><code>addr::String</code></p></li><li><p><code>port::UInt64</code></p></li><li><p><code>hostkey::Union{Nothing, String}</code></p></li><li><p><code>key::Union{Nothing, LibSSH.PKI.SshKey}</code></p></li><li><p><code>auth_methods::Vector{LibSSH.AuthMethod}</code></p></li><li><p><code>log_verbosity::Int64</code></p></li><li><p><code>_listener_event::Base.Event</code></p></li><li><p><code>_listener_started::Bool</code></p></li><li><p><code>_lock::ReentrantLock</code></p></li><li><p><code>_message_callback::Union{Nothing, Function}</code></p></li><li><p><code>_message_callback_userdata::Any</code></p></li></ul><p>Wrapper around <a href="../bindings/#LibSSH.lib.ssh_bind"><code>lib.ssh_bind</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L117">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.listen" href="#LibSSH.listen"><code>LibSSH.listen</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">listen(handler::Function, bind::LibSSH.Bind; poll_timeout)
</code></pre><p>High-level function to listen for incoming requests and pass them off to a handler function. This will already set the auth methods on the session (from <code>Bind.auth_methods</code>) before calling the handler.</p><p>The <code>poll_timeout</code> argument refers to the timeout for polling the bind socket for new connections. It must be &gt;0 because otherwise it would never wake up if the socket was closed while waiting, but other than that the exact value doesn&#39;t matter much. It&#39;ll only control how frequently the listen loop wakes up to check if the bind has been closed yet.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L323">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.wait_for_listener" href="#LibSSH.wait_for_listener"><code>LibSSH.wait_for_listener</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">wait_for_listener(bind::LibSSH.Bind)
</code></pre><p>Waits for the main loop of <a href="#LibSSH.listen"><code>listen</code></a> to begin running on the bind.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L419">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.handle_key_exchange" href="#LibSSH.handle_key_exchange"><code>LibSSH.handle_key_exchange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">handle_key_exchange(session::LibSSH.Session) -&gt; Bool
</code></pre><p>Non-blocking wrapper around <a href="../bindings/#LibSSH.lib.ssh_handle_key_exchange-Tuple{Any}"><code>lib.ssh_handle_key_exchange()</code></a>. Returns <code>true</code> or <code>false</code> depending on whether the exchange succeeded.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L452">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.set_auth_methods-Tuple{LibSSH.Session, Vector{LibSSH.AuthMethod}}" href="#LibSSH.set_auth_methods-Tuple{LibSSH.Session, Vector{LibSSH.AuthMethod}}"><code>LibSSH.set_auth_methods</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">set_auth_methods(
    session::LibSSH.Session,
    auth_methods::Vector{LibSSH.AuthMethod}
)
</code></pre><p>Set authentication methods on a <a href="../sessions_and_channels/#LibSSH.Session"><code>Session</code></a>.</p><p>Wrapper around <a href="../bindings/#LibSSH.lib.ssh_set_auth_methods-Tuple{Any, Any}"><code>lib.ssh_set_auth_methods()</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L428">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.set_auth_methods-Tuple{Ptr{LibSSH.lib.ssh_message_struct}, Vector{LibSSH.AuthMethod}}" href="#LibSSH.set_auth_methods-Tuple{Ptr{LibSSH.lib.ssh_message_struct}, Vector{LibSSH.AuthMethod}}"><code>LibSSH.set_auth_methods</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">set_auth_methods(
    msg::Ptr{LibSSH.lib.ssh_message_struct},
    auth_methods::Vector{LibSSH.AuthMethod}
)
</code></pre><p>Set authentication methods for a <code>lib.ssh_message</code>.</p><p>Wrapper around <a href="../bindings/#LibSSH.lib.message_auth_set_methods-Tuple{Any, Any}"><code>lib.message_auth_set_methods()</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L440">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Callbacks.ServerCallbacks" href="#LibSSH.Callbacks.ServerCallbacks"><code>LibSSH.Callbacks.ServerCallbacks</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct ServerCallbacks</code></pre><p>Wrapper around <a href="../bindings/#LibSSH.lib.ssh_server_callbacks_struct"><code>lib.ssh_server_callbacks_struct</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/callbacks.jl#L119">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Callbacks.ServerCallbacks-Tuple{}" href="#LibSSH.Callbacks.ServerCallbacks-Tuple{}"><code>LibSSH.Callbacks.ServerCallbacks</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">ServerCallbacks(; ...) -&gt; LibSSH.Callbacks.ServerCallbacks
ServerCallbacks(
    userdata;
    on_auth_password,
    on_auth_none,
    on_auth_gssapi_mic,
    on_auth_pubkey,
    on_service_request,
    on_channel_open_request_session
) -&gt; LibSSH.Callbacks.ServerCallbacks
</code></pre><p>Create a callbacks object to set on a server. This has basically the same behaviour as <a href="../sessions_and_channels/#LibSSH.Callbacks.ChannelCallbacks-Tuple{}"><code>ChannelCallbacks()</code></a>, except that there are some callbacks that are unsupported due to lack of documentation:</p><ul><li><code>gssapi_select_oid_function</code></li><li><code>gssapi_accept_sec_ctx_function</code></li><li><code>gssapi_verify_mic_function</code></li></ul><p>And <code>lib.ssh_key</code> arguments will be converted to a non-owning <a href="../utilities/#LibSSH.PKI.SshKey"><code>ssh.PKI.SshKey</code></a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Do not use <a href="../sessions_and_channels/#LibSSH.Session"><code>ssh.Session</code></a> or <a href="../utilities/#LibSSH.PKI.SshKey"><code>ssh.PKI.SshKey</code></a> arguments outside the callback functions. They are temporary non-owning wrappers around memory that may be free&#39;d unpredictably, which will result in dangling pointers and sadness.</p></div></div><p><strong>Parameters</strong></p><ul><li><code>userdata</code>: An arbitrary object that will be passed to each callback.</li><li><a href="../bindings/#LibSSH.lib.ssh_auth_password_callback"><code>on_auth_password</code></a>: <code>f(::Session, ::String, ::String, userdata)::AuthStatus</code></li><li><a href="../bindings/#LibSSH.lib.ssh_auth_none_callback"><code>on_auth_none</code></a>: <code>f(::Session, ::String, userdata)::AuthStatus</code></li><li><a href="../bindings/#LibSSH.lib.ssh_auth_gssapi_mic_callback"><code>on_auth_gssapi_mic</code></a>: <code>f(::Session, ::String, ::String, userdata)::AuthStatus</code></li><li><a href="../bindings/#LibSSH.lib.ssh_auth_pubkey_callback"><code>on_auth_pubkey</code></a>: <code>f(::Session, ::String, ::SshKey, ::Char, userdata)::AuthStatus</code></li><li><a href="../bindings/#LibSSH.lib.ssh_service_request_callback"><code>on_service_request</code></a>: <code>f(::Session, ::String, userdata)::Bool</code></li><li><a href="../bindings/#LibSSH.lib.ssh_channel_open_request_session_callback"><code>on_channel_open_request_session</code></a>: <code>f(::Session, userdata)::Union{SshChannel, Nothing}</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/callbacks.jl#L134">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.set_server_callbacks" href="#LibSSH.set_server_callbacks"><code>LibSSH.set_server_callbacks</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_server_callbacks(
    session::LibSSH.Session,
    callbacks::LibSSH.Callbacks.ServerCallbacks
)
</code></pre><p>Set callbacks for a Session. Wrapper around <a href="../bindings/#LibSSH.lib.ssh_set_server_callbacks-Tuple{Any, Any}"><code>lib.ssh_set_server_callbacks()</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L466">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.set_message_callback" href="#LibSSH.set_message_callback"><code>LibSSH.set_message_callback</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_message_callback(
    f::Function,
    bind::LibSSH.Bind,
    userdata
)
</code></pre><p>Set message callbacks for the sessions accepted by a Bind. This must be set before <a href="#LibSSH.listen"><code>listen</code></a> is called to take effect. <a href="#LibSSH.listen"><code>listen</code></a> will automatically set the callback before passing the session to the user handler.</p><p>The callback function must have the signature:</p><pre><code class="nohighlight hljs">f(session::Session, msg::lib.ssh_message, userdata)::Bool</code></pre><p>The return value indicates whether further handling of the message is necessary. It should be <code>true</code> if the message wasn&#39;t handled or needs to be handled by libssh, or <code>false</code> if the message was completely handled and doesn&#39;t need any more action from libssh.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.get_error-Tuple{LibSSH.Bind}" href="#LibSSH.get_error-Tuple{LibSSH.Bind}"><code>LibSSH.get_error</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_error(bind::LibSSH.Bind) -&gt; String
</code></pre><p>Get the last error set by libssh. Wrapper around <a href="../bindings/#LibSSH.lib.ssh_get_error-Tuple{Any}"><code>lib.ssh_get_error()</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L229">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.close-Tuple{LibSSH.Bind}" href="#Base.close-Tuple{LibSSH.Bind}"><code>Base.close</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">close(bind::LibSSH.Bind)
</code></pre><p>Close and free the bind.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.lock-Tuple{LibSSH.Bind}" href="#Base.lock-Tuple{LibSSH.Bind}"><code>Base.lock</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">lock(bind::LibSSH.Bind)
</code></pre><p>Lock a bind for thread-safe operations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L208">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.unlock-Tuple{LibSSH.Bind}" href="#Base.unlock-Tuple{LibSSH.Bind}"><code>Base.unlock</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">unlock(bind::LibSSH.Bind)
</code></pre><p>Unlock a bind.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.isopen-Tuple{LibSSH.Bind}" href="#Base.isopen-Tuple{LibSSH.Bind}"><code>Base.isopen</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">isopen(bind::LibSSH.Bind) -&gt; Bool
</code></pre><p>Check if the bind has been free&#39;d yet.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L222">source</a></section></article><hr/><p>Each <a href="../sessions_and_channels/#LibSSH.Session"><code>Session</code></a> accepted by a <a href="#LibSSH.Bind"><code>Bind</code></a> must be polled for all the handlers to execute. This is possible through the <a href="#LibSSH.SessionEvent"><code>SessionEvent</code></a> type.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.SessionEvent" href="#LibSSH.SessionEvent"><code>LibSSH.SessionEvent</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct SessionEvent</code></pre><ul><li><p><code>ptr::Union{Nothing, Ptr{LibSSH.lib.ssh_event_struct}}</code></p></li><li><p><code>session::LibSSH.Session</code></p></li></ul><p>This object wraps a <code>lib.ssh_event</code>, but it&#39;s designed to only allow adding a single session to it. Use this in a server to poll the session.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L4">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.SessionEvent-Tuple{LibSSH.Session}" href="#LibSSH.SessionEvent-Tuple{LibSSH.Session}"><code>LibSSH.SessionEvent</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">SessionEvent(session::LibSSH.Session) -&gt; LibSSH.SessionEvent
</code></pre><p>Create an empty <code>SessionEvent</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.event_dopoll" href="#LibSSH.event_dopoll"><code>LibSSH.event_dopoll</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">event_dopoll(event::LibSSH.SessionEvent) -&gt; Any
</code></pre><p>Non-blocking wrapper around <a href="../bindings/#LibSSH.lib.ssh_event_dopoll-Tuple{Any, Any}"><code>lib.ssh_event_dopoll()</code></a>. This may trigger callbacks on the session and its channels.</p><p>Returns either <code>SSH_OK</code> or <code>SSH_ERROR</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.close-Tuple{LibSSH.SessionEvent}" href="#Base.close-Tuple{LibSSH.SessionEvent}"><code>Base.close</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">close(event::LibSSH.SessionEvent)
</code></pre><p>Removes the <a href="../sessions_and_channels/#LibSSH.Session"><code>Session</code></a> from the underlying <code>ssh_event</code> and frees the event memory. This function may be safely called multiple times, and the event will be unusable afterwards.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L85">source</a></section></article><h2 id="Demo-server"><a class="docs-heading-anchor" href="#Demo-server">Demo server</a><a id="Demo-server-1"></a><a class="docs-heading-anchor-permalink" href="#Demo-server" title="Permalink"></a></h2><p>The <code>DemoServer</code> is an extremely simple and limited implementation of an SSH server using the libssh <a href="https://api.libssh.org/stable/group__libssh__server.html">server API</a>. It&#39;s so limited in fact that for the sake of simplicity it only supports a single &#39;operation&#39; per instance after authentication (e.g. running one command or forwarding one port). It&#39;s sole reason for existence is to be used in test suites to test client code. Do <strong>not</strong> expose this publicly! See the constructors docstrings for examples of how to use it (the LibSSH.jl test suite may also be informative).</p><p>Supported features:</p><ul><li>Password authentication: only the password is checked, not the username.</li><li>Keyboard-interactive authentication: the server will give two prompts for a <code>Password:</code> and <code>Token:</code> and expect <code>foo</code> and <code>bar</code> as answers, respectively.</li><li>Command execution: note that requested environment variables from the client are currently ignored, and the command output will only be sent back to the client after the command has finished.</li><li>Direct port forwarding</li></ul><p>Unsupported features (that may be implemented in the future):</p><ul><li>Public key authentication</li><li>GSSAPI authentication</li><li>Reverse port forwarding</li></ul><p>One might ask the question, why use a demo server for testing instead of something battle-hardened like <code>sshd</code>? Well, turns out that it&#39;s impossible to run <code>sshd</code> as a non-root user unless you disable password authentication (because <code>sshd</code> needs to read <code>/etc/passwd</code>), which is definitely something we want to test. Plus, having a custom server makes it simpler to set up in just the way we want.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.DemoServer" href="#LibSSH.Demo.DemoServer"><code>LibSSH.Demo.DemoServer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">mutable struct DemoServer</code></pre><ul><li><p><code>bind::LibSSH.Bind</code></p></li><li><p><code>listener_task::Union{Nothing, Task}</code></p></li><li><p><code>sshchan::Union{Nothing, LibSSH.SshChannel}</code></p></li><li><p><code>verbose::Bool</code></p></li><li><p><code>password::Union{Nothing, String}</code></p></li><li><p><code>clients::Vector{LibSSH.Demo.Client}</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L703">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.DemoServer-Tuple{Function, Vararg{Any}}" href="#LibSSH.Demo.DemoServer-Tuple{Function, Vararg{Any}}"><code>LibSSH.Demo.DemoServer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">DemoServer(
    f::Function,
    args...;
    timeout,
    kill_timeout,
    kwargs...
) -&gt; Any
</code></pre><p>Do-constructor to execute a function <code>f()</code> while the server is running and have it safely cleaned up afterwards. There are two keyword arguments to be aware of:</p><ul><li><code>timeout</code> (default 10s): set a timeout in seconds for <code>f()</code>. If <code>f()</code> doesn&#39;t finish before the timeout an <code>InterruptException</code> will be thrown to it.</li><li><code>kill_timeout</code> (default 3s): set a waiting time in seconds for <code>f()</code> to exit <em>after</em> throwing it an <code>InterruptException</code>. Sometimes you may want to cleanup things before exiting, and this gives some time to do that. If <code>f()</code> isn&#39;t finished after <code>kill_timeout</code> no futher action will be taken.</li></ul><p><code>args</code> and <code>kwargs</code> will all be passed to <a href="#LibSSH.Demo.DemoServer-Tuple{Int64}"><code>DemoServer(::Int)</code></a>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; import LibSSH.Demo: DemoServer

julia&gt; DemoServer(2222; password=&quot;foo&quot;) do
           run(`sshpass -p foo ssh -o NoHostAuthenticationForLocalhost=yes -p 2222 localhost echo &#39;Hello world!&#39;`)
       end
Hello world!</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L753">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.DemoServer-Tuple{Int64}" href="#LibSSH.Demo.DemoServer-Tuple{Int64}"><code>LibSSH.Demo.DemoServer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">DemoServer(
    port::Int64;
    verbose,
    password,
    auth_methods,
    log_verbosity
) -&gt; LibSSH.Demo.DemoServer
</code></pre><p>Creates a <a href="#LibSSH.Demo.DemoServer"><code>DemoServer</code></a>.</p><p><strong>Parameters</strong></p><ul><li><code>port</code>: The port to listen to.</li><li><code>verbose</code>: This verbosity doesn&#39;t refer to the log messages from libssh but from the <code>DemoServer</code>. If this is <code>true</code> it print messages on events like authentication etc. Useful for high-level debugging. The events can always be printed afterwards with <a href="#LibSSH.Demo.print_timeline-Tuple{LibSSH.Demo.DemoServer}"><code>Demo.print_timeline</code></a>.</li><li><code>password</code>: The password to use if password authentication is enabled.</li><li><code>auth_methods</code>: A list of authentication methods to enable. See <a href="../sessions_and_channels/#LibSSH.AuthMethod"><code>ssh.AuthMethod</code></a>.</li><li><code>log_verbosity</code>: Controls the logging of libssh itself. This could be e.g. <code>lib.SSH_LOG_WARNING</code> (see the <a href="https://api.libssh.org/stable/group__libssh__log.html#ga06fc87d81c62e9abb8790b6e5713c55b">upstream documentation</a>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L717">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.print_timeline-Tuple{LibSSH.Demo.DemoServer}" href="#LibSSH.Demo.print_timeline-Tuple{LibSSH.Demo.DemoServer}"><code>LibSSH.Demo.print_timeline</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">print_timeline(ds::LibSSH.Demo.DemoServer)
</code></pre><p>Print a nicely formatted timeline of callbacks and their logged data. Useful when debugging.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L909">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.start-Tuple{LibSSH.Demo.DemoServer}" href="#LibSSH.Demo.start-Tuple{LibSSH.Demo.DemoServer}"><code>LibSSH.Demo.start</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">start(demo_server::LibSSH.Demo.DemoServer)
</code></pre><p>Start a <a href="#LibSSH.Demo.DemoServer"><code>DemoServer</code></a>, which means bind to a port and start the <a href="#LibSSH.listen"><code>ssh.listen</code></a> loop.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L859">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="LibSSH.Demo.stop-Tuple{LibSSH.Demo.DemoServer}" href="#LibSSH.Demo.stop-Tuple{LibSSH.Demo.DemoServer}"><code>LibSSH.Demo.stop</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">stop(demo_server::LibSSH.Demo.DemoServer)
</code></pre><p>Stop a <a href="#LibSSH.Demo.DemoServer"><code>DemoServer</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JamesWrigley/LibSSH.jl/blob/cc151b01aeced1021825e983f8280639bc6650f3/src/server.jl#L874">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sessions_and_channels/">« Sessions and Channels</a><a class="docs-footer-nextpage" href="../utilities/">Utilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 13 January 2024 00:46">Saturday 13 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
